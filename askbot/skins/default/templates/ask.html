{% extends "base.html" %}
<!-- template ask.html -->
{% block title %}{% spaceless %}{% trans %}Ask a question{% endtrans %}{% endspaceless %}{% endblock %}
{% block forejs %}
        <script type='text/javascript' src='{{"/js/com.cnprog.editor.js"|media}}'></script>
        <script type='text/javascript' src='{{"/js/com.cnprog.post.js"|media}}'></script>
        <script type='text/javascript' src='{{"/js/jquery.validate.min.js"|media}}'></script>
        <script type='text/javascript'>
            {% if settings.ENABLE_MATHJAX or settings.MARKUP_CODE_FRIENDLY %}
                var codeFriendlyMarkdown = true;
            {% else %}
                var codeFriendlyMarkdown = false;
            {% endif %}
        </script>
        <script type='text/javascript' src='{{"/js/wmd/showdown.js"|media}}'></script>
        <script type='text/javascript' src='{{"/js/wmd/wmd.js"|media}}'></script>
        <link rel="stylesheet" type="text/css" href="{{"/js/wmd/wmd.css"|media}}" />
        <script type="text/javascript">
        $().ready(function(){
            //set current module button style
            $("#nav_ask").attr('className',"on");
            $('#editor').TextAreaResizer();

            //highlight code synctax when editor has new text
            $("#editor").typeWatch({highlight: false, wait: 3000,
                             captureLength: 5, callback: lanai.highlightSyntax});

            //toggle preview of editor
            //todo remove copy-paste
            var display = true;
            var txt = "[{% trans %}hide preview{% endtrans %}]";
            $('#pre-collapse').text(txt);
            $('#pre-collapse').bind('click', function(){
                txt = display ? "[{% trans %}show preview{% endtrans %}]" : "[{% trans %}hide preview{% endtrans %}]";
                display = !display;
                $('#previewer').toggle();
                $('#pre-collapse').text(txt);
            });

            //Tags autocomplete action
            var tags = {{ tags|safe }};
                $("#id_tags").autocomplete(tags, {
                    minChars: 1,
                    matchContains: true,
                    max: 20,
                    multiple: true,
                    multipleSeparator: " ",
                    formatItem: function(row, i, max) {
                        return row.n + " ("+ row.c +")";
                    },
                    formatResult: function(row, i, max){
                        return row.n;
                    }

            });

            setupFormValidation("#fmask", CPValidator.getQuestionFormRules(), CPValidator.getQuestionFormMessages());
            lanai.highlightSyntax();

        });
        </script>
{% endblock %}
{# main contents of ask form is in the template input_bar #}
{% block sidebar %}
{% include "question_edit_tips.html" %}
{% endblock %}

{% block endjs %}
{% endblock %}
<!-- end template ask.html -->
