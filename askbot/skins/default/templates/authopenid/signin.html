{% extends "base.html" %}
<!-- signin.html -->
{% load i18n %}
{% load extra_tags %}
{% load smart_if %}
{% block title %}{% spaceless %}{% trans "User login" %}{% endspaceless %}{% endblock %}
{% block forejs %}
    <script type='text/javascript' src='{% media  "/js/jquery.validate.pack.js" %}'></script>

        <link rel="stylesheet" type="text/css" media="screen" href="{% media  "/jquery-openid/openid.css" %}"/>
        <script type="text/javascript" src="{% media  "/jquery-openid/jquery.openid.js" %}"></script>
        <script type="text/javascript">  $().ready( function() { $("form.openid:eq(0)").openid(); })</script>
        <!--<script type="text/javascript">
        $().ready(function(){
            openid.init('id_openid_url');
            setupFormValidation("#openid_form", {bsignin:{required: true}});
        });
        </script>-->
{% endblock %}
{% block content %}
<h1>{{page_title}}</h1>
    {% if answer %}
        <div class="message">
        {% blocktrans with answer.question.title as title and answer.summary as summary %}
        Your answer to {{title}} {{summary}} will be posted once you log in
        {% endblocktrans %}
        </div>
    {% endif %}
    {% if question %}
        <div class="message">
        {% blocktrans with question.title as title and question.summary as summary %}Your question 
        {{title}} {{summary}} will be posted once you log in
        {% endblocktrans %}
        </div>
    {% endif %}
    <form id="openid_form" name="openid_form" class="openid" method="post" action="{% url user_signin %}"> 
    <p id='ab-login-method-prompt'>
    {% if view_subtype == 'default' or view_subtype == 'email_sent' %}
        {% trans "You can use your favorite service from those listed below to sign in using secure OpenID or similar technology. Your external service password always stays confidential and you don't have to rememeber or create another one." %}
    {% endif %}
    {% if view_subtype == 'add_openid' %}
        {% trans "Please add a more permanent login method by clicking one of the icons below, to avoid logging in via email each time. All of the services listed below provide a secure sign-in method based on OpenID or similar technology." %}
    {% endif %}
    {% if view_subtype == 'change_openid' %}
        {% if existing_login_methods %}
            {% trans "Click on one of the icons below to add a new login method or re-validate an existing one." %}
        {% else %}
            {% trans "You don't have a method to log in right now, please add one or more by clicking any of the icons below." %}
        {% endif %}
    {% endif %}
    </p>
    {% if openid_error_message %}
        <p class="warning">{{ openid_error_message }}</p>
    {% endif %}
    <table> 
        {% comment %}
        <li class="local" title="Local login">
            <div class="logo_box local_login_box">
                <img src="{% media  "/jquery-openid/images/logo-small.gif" %}" 
                    alt="your icon here" /> 
            </div>
        <span></span>
        </li> 
       {% endcomment %}
        <tr class="providers">
            <td class="username" title="OpenID URL"> 
                <div class="logo_box openid_box">
                    <img src="{% media  "/jquery-openid/images/openid.gif" %}" alt="icon" />
                    <span>http://<strong>username</strong></span>
                </div>
            </td> 
            <td class="direct" title="Google"> 
                <div class="logo_box google_box">
                    <img src="{% media  "/jquery-openid/images/google.gif" %}" alt="icon" />
                    <span>https://www.google.com/accounts/o8/id</span>
                </div>
            </td>
                <td class="direct" title="Yahoo"> 
                    <div class="logo_box yahoo_box">
                        <img src="{% media  "/jquery-openid/images/yahoo.gif" %}" alt="icon" />
                        <span>http://yahoo.com/</span>
                    </div>
                </td>
                <td class="username" title="AOL screen name"> 
                    <div class="logo_box aol_box">
                        <img src="{% media  "/jquery-openid/images/aol.gif" %}" alt="icon" />
                        <span>http://openid.aol.com/<strong>username</strong></span>
                    </div>
                </td>
            </tr>
        </table>
        <table>
            <tr id="openid_small_providers" class="providers"> 
                {% comment %}
                <li class="openid" title="OpenID">
                    <div class="logo_box openid_box">
                    <img src="/jquery-openid/images/openid.gif" alt="icon" /> 
                    </div>
                    <span><strong>http://{your-openid-url}</strong></span>
                </li>
                <li class="first_tiny_li facebook" title="Facebook Connect">
                    {% if question %}
                    <fb:login-button onlogin="window.location = '{% url fb_signin_new_question %}'"></fb:login-button>
                    {% else %}
                        {% if answer %}
                        <fb:login-button onlogin="window.location = '{% url fb_signin_new_answer %}'"></fb:login-button>
                        {% else %}
                        <fb:login-button onlogin="window.location = '{% url fb_signin %}'"></fb:login-button>
                        {% endif %}
                    {% endif %}                    
                </li>
                <li class="openid first_tiny_li" title="OpenID URL"> 
                    <img src="{% media  "/jquery-openid/images/openidico16.png" %}" alt="icon" />
                    <span>http://{your-openid-url}
                </li> 
                {% endcomment %}
                <td class="username first_tiny_li" title="MyOpenID user name"> 
                    <img src="{% media  "/jquery-openid/images/myopenid-2.png" %}" alt="icon" />
                    <span>http://<strong>username</strong>.myopenid.com/</span>
                </td> 
                <td class="username" title="Flickr user name"> 
                    <img src="{% media  "/jquery-openid/images/flickr.png" %}" alt="icon" />
                    <span>http://flickr.com/<strong>username</strong>/</span>
                </td> 
                <td class="username" title="Technorati user name"> 
                    <img src="{% media  "/jquery-openid/images/technorati-1.png" %}" alt="icon" />
                    <span>http://technorati.com/people/technorati/<strong>username</strong>/</span>
                </td> 
                <td class="username" title="Wordpress blog name"> 
                    <img src="{% media  "/jquery-openid/images/wordpress.png" %}" alt="icon" />
                    <span>http://<strong>username</strong>.wordpress.com</span>
                </td> 
                <td class="username" title="Blogger blog name"> 
                    <img src="{% media  "/jquery-openid/images/blogger-1.png" %}" alt="icon" />
                    <span>http://<strong>username</strong>.blogspot.com/</span>
                </td> 
                <td class="username" title="LiveJournal blog name"> 
                    <img src="{% media  "/jquery-openid/images/livejournal-1.png" %}" alt="icon" />
                    <span>http://<strong>username</strong>.livejournal.com</span>
                </td> 
                <td class="username" title="ClaimID user name"> 
                    <img src="{% media  "/jquery-openid/images/claimid-0.png" %}" alt="icon" />
                    <span>http://claimid.com/<strong>username</strong></span>
                </td> 
                <td class="username" title="Vidoop user name"> 
                    <img src="{% media  "/jquery-openid/images/vidoop.png" %}" alt="icon" />
                    <span>http://<strong>username</strong>.myvidoop.com/</span>
                </td> 
                <td class="username" title="Verisign user name"> 
                    <img src="{% media  "/jquery-openid/images/verisign-2.png" %}" alt="icon" />
                    <span>http://<strong>username</strong>.pip.verisignlabs.com/</span>
                </td> 
            </tr>
        </table>
        {{ openid_login_form.next }}
        <fieldset style="display:none;"> 
            <p id="provider_name_slot">{% trans 'Enter your <span id="enter_your_what">Provider user name</span>' %}</p> 
            <div><p><span></span>
                <input id="openid_username" type="text" name="openid_username" /><span></span> 
                <input type="submit" value="{% trans "Login" %}" />
            </p></div>
        </fieldset> 
        <fieldset style="display:none"> 
            <p>{% trans 'Enter your <a class="openid_logo" href="http://openid.net">OpenID</a> web address' %}</p> 
            <div><p><input id="openid_url" type="text" value="http://" name="openid_url" /> 
            <input id="bsignin" name="bsignin" type="submit" value="{% trans "Login" %}" /></p></div> 
        </fieldset> 
        {% comment %}
        <fieldset id='local_login_fs'>
            <p>{% trans 'Enter your login name and password' %}</p> 
            {% if password_login_form.errors %}
            {{password_login_form.non_field_errors.as_ul}}
            {% endif %}
            <div>
                <p class="login">
                    <label for="id_username">{% trans "Login name" %}</label>
                    {{password_login_form.username}}
                </p>
                <p class="login">
                    <label for="id_password">{% trans "Password" %}</label>
                    {{password_login_form.password}}
                </p>
                <p id="local_login_buttons">
                    <input id="blogin" name="blogin" type="submit" value="{% trans "Login" %}" />
                    <a href="{% url user_signup %}">{% trans "Create account" %}</a><br/>
                    <a href="{% url user_sendpw %}">{% trans "Forgot your password?" %}</a>
                </p>
            </div>
        </fieldset>
        {% endcomment %}
    </form>
    {% if view_subtype == 'default' or view_subtype == 'email_sent' %}
    <form action="{% url user_account_recover %}" method="post">
        {% if view_subtype == 'email_sent' %}
            <h2>{% trans "Account recovery email sent" %}</h2>
        {% else %}
            <h2>{% trans "Still have trouble accessing your account?" %}</h2>
        {% endif %}
        {% if account_recovery_message %}
            <p>{{account_recovery_message}}</p>
        {% else %}
            <p>{% trans "Please, enter your email address below to recover" %}</p>
        {% endif %}
        {{ account_recovery_form.email }}
        <input type="submit" value="{% trans "Recover your account via email" %}"/>
    </form>
    {% endif %}
    {% if view_subtype == 'change_openid' %}
        {% if existing_login_methods %}
            <h2 id='ab-show-login-methods'>
                {% trans "Here are your current login methods" %}
            </h2>
            <table id='ab-existing-login-methods'>
                <tr>
                    <th>{% trans "provider" %}</th>
                    <th>{% trans "last used" %}</th>
                    <th>{% trans "delete, if you like" %}</th>
                </tr>
                {% for login_method in existing_login_methods %}
                <tr class="ab-provider-row">
                    <td class="ab-provider-name">
                        {{login_method.provider_name}}
                    </td>
                    <td>
                        {% if login_method.last_used_timestamp %}
                            {% diff_date login_method.last_used_timestamp %}
                        {% endif %}
                    </td>
                    <td>
                        <button>{% trans "delete" %}</button>
                    </td>
                </tr>
                {% endfor %}
            </table>
            <script type="text/javascript">
            $(document).ready(
                function(){
                    var provider_count = {{existing_login_methods|length}};
                    $('.ab-provider-row').each(
                        function(i, provider_row){
                            var provider_name = $(
                                                provider_row
                                            ).find(
                                                '.ab-provider-name'
                                            ).html().trim();
                            var remove_button = $(
                                                provider_row
                                            ).find('button');
                            remove_button.click(
                                function(){
                                    var message = $.i18n._(
                                                            'Are you sure you want to remove ' +
                                                            'your {provider} login?'
                                                        ).replace(
                                                            '{provider}', 
                                                            provider_name
                                                        );
                                    if (confirm(message)){
                                        $.ajax({
                                            type: 'POST',
                                            url: '{% url delete_login_method %}',
                                            data: {provider_name: provider_name},
                                            success: function(data, text_status, xhr){
                                                $(provider_row).remove();
                                                provider_count -=1;
                                                if (provider_count < 0){
                                                    provider_count === 0;
                                                }
                                                if (provider_count === 0){
                                                    $('#ab-existing-login-methods').remove();
                                                    $('#ab-show-login-methods').remove();
                                                    $('h1').html(
                                                        $.i18n._("Please add one or more login methods.")
                                                    );
                                                    $('#ab-login-method-prompt').html(
                                                        $.i18n._("You don\'t have a method to log in right now, please add one or more by clicking any of the icons below.")
                                                    );
                                                    alert($.i18n._('You have deleted all login methods, please add at least one'));
                                                }
                                            },

                                        });
                                    }
                                }
                            );
                        }
                    );
                }
            );
            </script>
        {% endif %}
    {% endif %}
{% endblock %}

{% block sidebar %}
<div class="boxC">
    <h3 class="subtitle">{% trans "Why use OpenID?" %}</h3>
    <ul class="list-item">
        <li>
            {% trans "with openid it is easier" %}
        </li>
        <li>
            {% trans "reuse openid" %}
        </li>
        <li>
            {% trans "openid is widely adopted" %}
        </li>
        <li>
            {% trans "openid is supported open standard" %}
        </li>
        
    </ul>
    <p class="info-box-follow-up-links">
        <a href="http://openid.net/what/" target="_blank">{% trans "Find out more" %} »</a><br/>
        <a href="http://openid.net/get/" target="_blank">{% trans "Get OpenID" %} »</a>
    </p>
</div>
{% comment %}
<script type="text/javascript" src="http://static.ak.connect.facebook.com/js/api_lib/v0.4/FeatureLoader.js.php"></script>
<script type="text/javascript">  FB.init("{{ settings.FB_API_KEY }}","{% url  xd_receiver %}");</script> 
{% endcomment %}
{% endblock%}

<script type="text/javascript">  $( function() { $("form.openid:eq(0)").openid(); })</script>
<!-- end signin.html -->
